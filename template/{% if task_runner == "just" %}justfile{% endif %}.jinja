# Default recipe to display help
_default:
    @just --list

# Build a python wheel package
build:
    uv build --wheel

# Bump the project version and create a tag
bump:
    #!/usr/bin/env bash
    read -p "Version part [major, minor, patch]: " version_part
    uv run bump-my-version bump $version_part

# Setup the development environment
setup:
    uv sync
    cp .pre-commit-configs/base.yaml .pre-commit-config.yaml
    cat .pre-commit-configs/addon.standard.yaml >> .pre-commit-config.yaml
    {% if type_checker == "mypy" %}
    cat .pre-commit-configs/addon.mypy.yaml >> .pre-commit-config.yaml
    {% endif %}
    uv run pre-commit install

# Setup the development environment with custom configuration
setup-custom:
    #!/usr/bin/env bash
    uv sync
    cp .pre-commit-configs/base.yaml .pre-commit-config.yaml
    {% if enable_docstring_linting %}
    read -p "Include docstring linting in pre-commit hooks? [Y/n]: " include_docstrings
    if [[ "$include_docstrings" =~ ^[Nn]$ ]]; then
        sed 's/ruff check/ruff check --extend-ignore D/' .pre-commit-configs/addon.standard.yaml >> .pre-commit-config.yaml
        echo "✓ Docstring linting excluded from pre-commit (still enforced in {{ task_runner }} lint and CI)"
    else
        cat .pre-commit-configs/addon.standard.yaml >> .pre-commit-config.yaml
        echo "✓ Docstring linting included in pre-commit"
    fi
    {% else %}
    cat .pre-commit-configs/addon.standard.yaml >> .pre-commit-config.yaml
    {% endif %}
    {% if type_checker == "mypy" %}
    read -p "Include type checking (mypy) in pre-commit hooks? [Y/n]: " include_mypy
    if [[ "$include_mypy" =~ ^[Nn]$ ]]; then
        echo "✓ Type checking excluded from pre-commit (still enforced in {{ task_runner }} lint and CI)"
    else
        cat .pre-commit-configs/addon.mypy.yaml >> .pre-commit-config.yaml
        echo "✓ Type checking included in pre-commit"
    fi
    {% endif %}
    uv run pre-commit install

# Runs linting on all project files
lint:
    #!/usr/bin/env bash
    tempfile=$(mktemp)
    trap 'rm -f $tempfile' EXIT
    cat .pre-commit-configs/base.yaml .pre-commit-configs/addon.standard.yaml {% if type_checker == "mypy" %} .pre-commit-configs/addon.mypy.yaml{% endif +%} > $tempfile
    uv run pre-commit run --all-files -c $tempfile

# Run the project tests
test:
    uv run pytest
{% if generate_docs == "mkdocs" %}

# Build documentation
docs:
    uv run mkdocs build --site-dir build/site

# Build documentation and serve it locally
serve-docs:
    uv run mkdocs serve
{% elif generate_docs == "pdoc" %}

# Build documentation
docs:
    uv run pdoc --output-directory build/site src/{{ package_name }}

# Build documentation and serve it locally
serve-docs:
    uv run pdoc src/{{ package_name }}
{% endif %}
